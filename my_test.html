<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="stylesheet.css">
  <title>Kun's Spell Bee Challenge</title>
</head>
<body>
  <h1>Kun's Spell Bee Challenge</h1>
  <button id="nextWordBtn" disabled>Choose Next Word</button>
  <button id="printWordBtn" disabled>Print Spelling and Definition</button>
  <button id="pronounceWordBtn" disabled>Pronounce</button>
  <button id="spellWordBtn" disabled>Spell</button>
  <p id="wordDisplay"></p>
  <p id="wordExplanation"></p>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
  <script>
    const pronounceWordBtn = document.getElementById('pronounceWordBtn');
    const spellWordBtn = document.getElementById('spellWordBtn');
    const printWordBtn = document.getElementById('printWordBtn');
    const nextWordBtn = document.getElementById('nextWordBtn');
    const wordDisplay = document.getElementById('wordDisplay');
    const wordExplanation = document.getElementById('wordExplanation');
    const pdfUrl = 'https://kunhong-ai.github.io/spellbee_test/test_vocabulary.pdf'; // PDF file URL
    let words = [];
    let currentWord = '';

    // Load and parse the PDF
    async function loadPdf() {
      const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
      let text = '';

      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map((item) => item.str).join(' ');
      }

      words = text.split(/\s+/).filter((word) => word.length > 0);
      nextWordBtn.disabled = false;
      pronounceWordBtn.disabled = true; // Enable the speak button
      printWordBtn.disabled = true; // Enable the print button
      spellWordBtn.disabled = true;
    }

    // Choose a new random word
    function chooseRandomWord() {
      if (words.length === 0) return;
      currentWord = words[Math.floor(Math.random() * words.length)];
      if (currentWord.includes('/'))
        return chooseRandomWord()
      speakWord();
      printWordBtn.disabled = false;
      spellWordBtn.disabled = true;
      pronounceWordBtn.disabled = false;
      return currentWord;
    }

    // Speak the chosen word
    function speakWord() {
      if (!currentWord) return;

      const utterance = new SpeechSynthesisUtterance(currentWord);
      speechSynthesis.speak(utterance);
    }

    // Print the chosen word and speak its spelling
    function printWord() {
      if (!currentWord) return;

      // Display the word on the page
      wordDisplay.textContent = `Word: ${currentWord}`;
      explainWord();

      // Disable the "Print Random Word" button until a new word is chosen
      printWordBtn.disabled = true;
      nextWordBtn.disabled = false;
      pronounceWordBtn.disabled = false;
      spellWordBtn.disabled = false;
    }

    function spellWord() {
      // Speak the spelling (character by character)
      for (const char of currentWord) {
        const utterance = new SpeechSynthesisUtterance(char);
        speechSynthesis.speak(utterance);
      }

    }

// Fetch and display word explanation and example sentences
async function explainWord() {
  if (!currentWord) return;

  const apiKey = '47a4f771-5c32-4afa-bf93-9adcb8921a9c'; // Replace with your actual API key
  const apiUrl = `https://www.dictionaryapi.com/api/v3/references/learners/json/${currentWord}?key=${apiKey}`;

  try {
    const response = await fetch(apiUrl);
    if (!response.ok) {
      throw new Error('Word not found');
    }
    const data = await response.json();

    if (data.length === 0 || !data[0].shortdef) {
      throw new Error('No definition available');
    }

    const explanation = data[0].shortdef[0]; // Get the first definition
    const example = data[0].def && data[0].def[0].sseq && data[0].def[0].sseq[0][0][1].dt
      ? data[0].def[0].sseq[0][0][1].dt[1][1]
      : 'No example available.';

    wordExplanation.innerHTML = `
      <p>Explanation: ${explanation}</p>
      <p>Example: ${example}</p>
    `;
  } catch (error) {
    wordExplanation.textContent = `Error: ${error.message}`;
  }
}

    // Initialize the app
    window.addEventListener('DOMContentLoaded', () => {
      loadPdf(); // Automatically load the PDF
      nextWordBtn.addEventListener('click', chooseRandomWord); // Attach speak button event
      printWordBtn.addEventListener('click', printWord); // Attach print button event
      pronounceWordBtn.addEventListener('click', speakWord); 
      spellWordBtn.addEventListener('click', spellWord); 
    });
  </script>
</body>
</html>
